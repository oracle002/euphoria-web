{"version":3,"file":"hooks.server-9rHsANLu.js","sources":["../../../.svelte-kit/adapter-node/chunks/hooks.server.js"],"sourcesContent":["import \"./index.js\";\nimport { c as createAuthToken } from \"./Authentication.js\";\nimport { c as connection, a as client } from \"./connection.js\";\nconst handle = async ({ event, resolve }) => {\n  const { cookies } = event;\n  const token = cookies.get(\"session\");\n  if (token) {\n    const [b64, hash] = token.split(\".\");\n    const email = atob(b64);\n    try {\n      const participant = await connection.findParticipantByAttribute({ email });\n      if (!participant) {\n        return resolve(event);\n      }\n      delete participant.password;\n      const generatedHash = createAuthToken(participant.participant_id, participant.email);\n      if (generatedHash === hash) {\n        event.locals.user = participant;\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  }\n  const admin = cookies.get(\"admin\");\n  if (admin) {\n    const [b64, hash] = admin.split(\".\");\n    const username = atob(b64);\n    try {\n      const adminUser = await client.admins.findFirst({ where: { username } });\n      if (!adminUser) {\n        return resolve(event);\n      }\n      const generatedHash = createAuthToken(adminUser.admin_id, adminUser.username);\n      if (generatedHash === hash) {\n        event.locals.admin = adminUser;\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  }\n  const viewer = cookies.get(\"viewer\");\n  if (viewer) {\n    const [b64, hash] = viewer.split(\".\");\n    const email = atob(b64);\n    try {\n      const viewer2 = await client.viewers.findFirst({ where: { email } });\n      if (!viewer2) {\n        return resolve(event);\n      }\n      const generatedHash = createAuthToken(viewer2.viewer_id, viewer2.email);\n      if (generatedHash === hash) {\n        event.locals.viewer = viewer2;\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  }\n  return resolve(event);\n};\nexport {\n  handle\n};\n"],"names":[],"mappings":"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"}